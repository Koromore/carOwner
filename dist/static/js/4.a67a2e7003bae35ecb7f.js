webpackJsonp([4],{GlTO:function(e,t){},ThFq:function(e,t){},zrp1:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("bOdI"),i=s.n(a),l={name:"addTask",components:{},data:function(){var e;return e={userId:this.$store.state.user.userId,deptId:this.$store.state.user.deptId,taskId:"",type:0,title:"新建任务",options2:[],input:"",input1:"",input2:"",textarea:"",props:{multiple:!0},carSeriesList:[],input3:"",options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],input4:"",input5:"",fileList:[],taskName:"",listInviteList:[]},i()(e,"carSeriesList",[]),i()(e,"carSeriesId",[]),i()(e,"seriesId",""),i()(e,"periodTime",[]),i()(e,"taskNum",""),i()(e,"listTaskFile",[]),i()(e,"taskDesc",""),i()(e,"remark",""),i()(e,"taskFileList",""),i()(e,"fileList",[]),i()(e,"submitFlag",!0),i()(e,"putLoading",!1),e},watch:{carSeriesList:function(e,t){0!=e.length&&this.getCarSeriesId()},seriesId:function(e,t){""!=e&&this.getCarSeriesId()}},beforeCreate:function(){},beforeMount:function(){},mounted:function(){this.getQuery(),this.getCarSeriesLists(),this.getOwnerList()},methods:{getQuery:function(){var e=this.$route.query.type,t=this.$route.query.id;this.type=e,0==e?(this.title="新建任务",this.taskId=""):1==e&&(this.title="编辑任务",this.taskId=t,this.getTaskDetail(t))},getCarSeriesId:function(){var e=this,t=[];this.carSeriesList.forEach(function(s){s.children.forEach(function(a){a.children.forEach(function(i){i.value==e.seriesId&&(t.push(s.value),t.push(a.value),t.push(i.value))})})}),this.carSeriesId=t},getTaskDetail:function(e){var t=this,s={taskId:e};this.$axios.post("/ocarplay/task/edit",s).then(function(e){if(200==e.status){var s=e.data;t.taskName=s.taskName;var a=[];s.listInvite.forEach(function(e){a.push([e.listOwnerType[0].typeId,e.listOwnerItem[0].itemId,e.ownerId])}),t.listInviteList=a,t.seriesId=s.carSeriesId,t.periodTime=[new Date(s.startTime.replace(/-/g,"/")),new Date(s.endTime.replace(/-/g,"/"))],t.taskNum=s.num,t.taskDesc=s.taskDesc,t.remark=s.remark;var i=[];s.listTaskFile.forEach(function(e){i.push({name:e.fileName,url:e.localPath})}),t.fileList=i}})},getOwnerList:function(){var e=this;this.$axios.post("/ocarplay/api/vehicleOwner/ownerTypeCoopItemOwners",{}).then(function(t){if(200==t.status){var s=[];t.data.forEach(function(e,t){s.push({value:e.typeId,label:e.typeName,children:[]}),e.ownerItems.forEach(function(e,a){s[t].children.push({value:e.itemId,label:e.itemName,children:[]}),e.vehicleOwners.forEach(function(e){e.coopNum&&e.alreadyCooperateNum&&e.coopNum-e.alreadyCooperateNum<=0?s[t].children[a].children.push({value:e.vehicleOwnerId,label:e.name,disabled:!0}):s[t].children[a].children.push({value:e.vehicleOwnerId,label:e.name})})})}),e.options2=s}})},getCarSeriesLists:function(){var e=this;this.$axios.post("/ocarplay/api/carSeries/getCarSeriesLists",{ids:0,pageNum:1,pageSize:30}).then(function(t){if(200==t.status){var s=[{value:105,label:"沃尔沃",children:[]},{value:110,label:"吉利舆情",children:[]},{value:153,label:"长城",children:[]}];t.data.items.forEach(function(e){var t={value:e.carTypeId,label:e.carTypeName,children:[]},a=e.carSeriesIds.split("/"),i=e.carSeriesName.split("/");a.forEach(function(e,s){t.children.push({value:1*e,label:i[s]})}),105==e.deptId?s[0].children.push(t):110==e.deptId?s[1].children.push(t):153==e.deptId&&s[2].children.push(t)}),e.carSeriesList=s}})},previous:function(){this.$router.push({path:"/home/task"})},taskFileSuccess:function(e,t,s){var a=[];s.forEach(function(e){a.push(e.response.data)}),this.taskFileList=a},taskFileRemove:function(e,t){var s=[];t.forEach(function(e){s.push(e.response.data)}),this.taskFileList=s},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},saveTask:function(){var e=this,t=this.periodTime,s="",a="";0!=t.length&&(s=this.$date0(t[0]),a=this.$date0(t[1]));var i=this.listInviteList,l={initUserId:this.userId,deptId:this.deptId,createTime:this.$time0(new Date),taskName:this.taskName,status:0,startTime:s,endTime:a,num:this.taskNum,carSeriesId:this.carSeriesId[2],taskDesc:this.taskDesc,remark:this.remark,listInvite:[],listTaskFile:this.taskFileList};i.forEach(function(e){l.listInvite.push({typeId:e[0],itemId:e[1],ownerId:e[2]})});var r=!0;[l.taskName,l.startTime,l.num,l.carSeriesId,l.taskDesc,l.remark,l.listInvite.length,l.listTaskFile.length].forEach(function(e){e||(r=!1)}),console.log(l),r?(this.putLoading=!0,this.$axios.post("/ocarplay/task/save",l).then(function(t){200==t.status&&1==t.data?(e.$message.success("任务新建成功！"),setTimeout(function(){e.$router.push({name:"task"})},1e3)):(e.$message.error("任务新建失败！"),e.putLoading=!1)}).catch(function(t){console.log(t),e.putLoading=!1})):this.$message.error("请检查信息是否填写完整！")},messageWin:function(e){this.$message({message:e,type:"success"})},messageWarning:function(e){this.$message({message:e,type:"warning"})},messageError:function(e){this.$message.error(e)}}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"addTask"}},[s("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.putLoading,expression:"putLoading"}],staticClass:"content"},[s("el-col",{staticClass:"title",attrs:{span:24}},[s("el-col",{staticClass:"previousBox",attrs:{span:6}},[s("div",{on:{click:e.previous}},[s("i",{staticClass:"el-icon-arrow-left"}),e._v("\n          返回\n        ")])]),e._v(" "),s("el-col",{attrs:{span:12}},[e._v(e._s(e.title))])],1),e._v(" "),s("el-col",{staticClass:"left",attrs:{span:12}},[s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("任务名称")]),e._v(" "),s("div",{staticClass:"val"},[s("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:e.taskName,callback:function(t){e.taskName=t},expression:"taskName"}})],1)]),e._v(" "),s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("任务对象")]),e._v(" "),s("div",{staticClass:"val"},[s("el-cascader",{attrs:{options:e.options2,props:e.props,clearable:"",filterable:""},model:{value:e.listInviteList,callback:function(t){e.listInviteList=t},expression:"listInviteList"}})],1)]),e._v(" "),s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("品牌车型")]),e._v(" "),s("div",{staticClass:"val"},[s("el-cascader",{attrs:{options:e.carSeriesList,clearable:"",filterable:""},model:{value:e.carSeriesId,callback:function(t){e.carSeriesId=t},expression:"carSeriesId"}})],1)]),e._v(" "),s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("计划周期")]),e._v(" "),s("div",{staticClass:"val"},[s("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.periodTime,callback:function(t){e.periodTime=t},expression:"periodTime"}})],1)]),e._v(" "),s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("计划邀约量")]),e._v(" "),s("div",{staticClass:"val"},[s("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:e.taskNum,callback:function(t){e.taskNum=t},expression:"taskNum"}})],1)]),e._v(" "),s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("任务文件")]),e._v(" "),s("div",{staticClass:"val"},[s("el-upload",{staticClass:"upload-demo",attrs:{action:"/ocarplay/file/upload","on-remove":e.taskFileRemove,"on-success":e.taskFileSuccess,"file-list":e.fileList}},[s("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"})],1)],1)])],1),e._v(" "),s("el-col",{staticClass:"right",attrs:{span:12}},[s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("任务描述")]),e._v(" "),s("div",{staticClass:"val valList"},[s("el-input",{attrs:{type:"textarea",rows:7,placeholder:"请输入内容"},model:{value:e.taskDesc,callback:function(t){e.taskDesc=t},expression:"taskDesc"}})],1)]),e._v(" "),s("el-col",{staticClass:"list",attrs:{span:24}},[s("div",{staticClass:"key"},[e._v("备注")]),e._v(" "),s("div",{staticClass:"val"},[s("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)])],1),e._v(" "),s("el-col",{staticClass:"put",attrs:{span:24}},[s("el-button",{attrs:{type:"primary"},on:{click:e.saveTask}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var n=s("VU/8")(l,r,!1,function(e){s("ThFq"),s("GlTO")},"data-v-e774b352",null);t.default=n.exports}});